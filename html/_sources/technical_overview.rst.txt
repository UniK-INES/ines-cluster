Technical Overview
******************

The cluster at Fachgebiet Integrierte Energiesysteme includes 48 RaspberryPi 3+ and 12 RaspberryPi Zero modules for computing and 2 additional RaspberryPi 3+ modules 
for managing the system. All modules contain an sd-card. The card itself is only used in the management modules.


Server Module
----------------------------


Network Interfaces
^^^^^^^^^^^^^^^^^^^^

+---------------------+--------------+------------------------------+-----------+
| Hardwareaddress     | Name         | IP                           | Rate      |
+=====================+==============+==============================+===========+
| B8:27:EB:36:A7:A3   | eth0         | 10.42.0.250                  | 100 MB/s  |
+---------------------+--------------+------------------------------+-----------+
| D0:37:45:88:8C:EF   | eth1         | 141.51.123.55                | 1000 MB/s |
+---------------------+--------------+------------------------------+-----------+
| D0:37:45:88:8C:EF   | wlan0        | 192.168.1.111                | 56 MB/s   |
+---------------------+--------------+------------------------------+-----------+

Important Services
^^^^^^^^^^^^^^^^^^^^

* **dnsmasq** used as DHCP and TFTP server
* **nfs-kernel-server** used for providing the root partition and the individual content directory
* **iptables** rules connecting eth0 and wlan0 interfaces


Homematic Module
----------------------------

The Homematic module is used to power the cluster. Additionally we use it in case one is not able to create a direct route into the cluster.

Network Interfaces
^^^^^^^^^^^^^^^^^^^^

+---------------------+--------------+------------------------------+-----------+
| Hardwareaddress     | Name         | IP                           | Rate      |
+=====================+==============+==============================+===========+
| DC:A6:32:36:33:2D   | eth0         | 141.51.123.42                | 100 MB/s  |
+---------------------+--------------+------------------------------+-----------+
| DC:A6:32:36:33:2F   | wlan0        | 192.168.1.134                |  56 MB/s  |
+---------------------+--------------+------------------------------+-----------+

Important Services
^^^^^^^^^^^^^^^^^^^^

* Debmatic / lighttpd running on `<http://141.51.123.42>`_


Router
----------------------------

The router provides a WiFi **nostromo** to the server module's wlan0 interface and the Zero client modules. When connected to the wifi you can add a route to the client modules with **192.168.1.111** (server module wlan0) as a gateway.

Network Interfaces
^^^^^^^^^^^^^^^^^^^^

+---------------------+--------------+------------------------------+-----------+
| Hardwareaddress     | Name         | IP                           | Rate      |
+=====================+==============+==============================+===========+
| B0:C7:45:3F:86:1B   | vlan2        | 141.51.123.4                 | 100 MB/s  |
+---------------------+--------------+------------------------------+-----------+
| B0:C7:45:3F:86:1C   | br0          | 192.168.1.1                  | 100 MB/s  |
+---------------------+--------------+------------------------------+-----------+


Client Modules
----------------------------

Hostnames and Hardware Address
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The clients ask the DHCP server to provide them a hostname. The hostname is given according to their hardware address. The geographical position row gives you information where the module is physically placed. Every bar starts with module 1 and ends with module 15. 4 single bars with 15 modules each bar.

+---------------------+--------------+---------------------+--------+-----------+
| Hardwareaddresses   | Hostname     | Geographical        | Typ    | SD Rate   |
+=====================+==============+=====================+========+===========+
| B8:27:EB:F1:32:3B   | host01       | 0x01                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:6F:45:23   | host02       | 0x02                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:C7:4F:DE   | host03       | 0x03                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:1F:C3:23   | host04       | 0x04                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:7E:F5:D9   | host05       | 0x05                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:73:CE:79   | host06       | 0x06                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:39:22:68   | host07       | 0x07                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:4E:CA:10   | host08       | 0x08                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:1E:E3:9F   | host09       | 0x09                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:53:F2:86   | host10       | 0x0A                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:85:AD:ED   | host11       | 0x0B                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:81:4C:93   | host12       | 0x0C                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:A2:47:0F   | host13       | 0x0D                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:B7:DB:0F   | host14       | 0x0E                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:52:06:8E   | host15       | 0x0F                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:81:7A:2D   | host16       | 0x11                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:BD:11:3E   | host17       | 0x12                | Zero   | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:74:8E:CC   | host18       | 0x13                | Zero   | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:37:0F:06   | host19       | 0x14                | Zero   | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:38:DD:C7   | host20       | 0x15                | Zero   | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:F6:A8:5D   | host21       | 0x16                | Zero   | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:8B:31:C7   | host22       | 0x17                | Zero   | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:FC:7E:24   | host23       | 0x18                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:07:54:46   | host24       | 0x19                | Zero   | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:41:EE:0C   | host25       | 0x1A                | Zero   | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:45:BA:43   | host26       | 0x1B                | Zero   | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:74:91:F0   | host27       | 0x1C                | Zero   | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:DC:5E:F8   | host28       | 0x1D                | Zero   | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:2E:33:17   | host29       | 0x1E                | Zero   | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:02:84:F0   | host30       | 0x1F                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:B1:1F:72   | host31       | 0x21                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:A7:F6:1B   | host32       | 0x22                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:A9:54:CD   | host33       | 0x23                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:AF:1A:F3   | host34       | 0x24                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:5B:8B:77   | host35       | 0x25                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:78:7B:A3   | host36       | 0x26                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:FC:01:AF   | host37       | 0x27                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:EF:D4:D5   | host38       | 0x28                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:D9:E1:52   | host39       | 0x29                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:DD:46:06   | host40       | 0x2A                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:32:AC:5D   | host41       | 0x2B                | R3     | 30 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:77:14:97   | host42       | 0x2C                | R3     | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:C7:CE:08   | host43       | 0x2D                | R3     | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:BD:D1:8F   | host44       | 0x2E                | R3     | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:57:6E:2F   | host45       | 0x2F                | R3     | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:1B:A6:F1   | host46       | 0x31                | R3     | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:7D:CE:3A   | host47       | 0x32                | R3     | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:E9:4A:87   | host48       | 0x33                | R3     | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:87:4D:83   | host49       | 0x34                | R3     | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:08:2F:DE   | host50       | 0x35                | R3     | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:F6:50:B8   | host51       | 0x36                | R3     | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:E8:C2:6A   | host52       | 0x37                | R3     | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:96:CB:E9   | host53       | 0x38                | R3     | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:84:75:97   | host54       | 0x39                | R3     | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:E2:C3:6E   | host55       | 0x3A                | R3     | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:26:3C:3D   | host56       | 0x3B                | R3     | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:4C:6F:A5   | host57       | 0x3C                | R3     | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:09:31:48   | host58       | 0x3D                | R3     | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:AA:89:FA   | host59       | 0x3E                | R3     | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+
| B8:27:EB:D3:C9:CC   | host60       | 0x3F                | R3     | 10 MB/s   |
+---------------------+--------------+---------------------+--------+-----------+


Geographical Position
^^^^^^^^^^^^^^^^^^^^^^

This table provides an easier way to get a client module's hardware address when you stand infront of the cluster.

+----------+---------------------+---------------------+---------------------+---------------------+
| Bitbar   | 0                   | 1                   | 2                   | 3                   |
+==========+=====================+=====================+=====================+=====================+
| 0x1      | B8:27:EB:F1:32:3B   | B8:27:EB:81:7A:2D   | B8:27:EB:B1:1F:72   | B8:27:EB:1B:A6:F1   |
+----------+---------------------+---------------------+---------------------+---------------------+
| 0x2      | B8:27:EB:6F:45:23   | B8:27:EB:BD:11:3E   | B8:27:EB:A7:F6:1B   | B8:27:EB:7D:CE:3A   |
+----------+---------------------+---------------------+---------------------+---------------------+
| 0x3      | B8:27:EB:C7:4F:DE   | B8:27:EB:74:8E:CC   | B8:27:EB:A9:54:CD   | B8:27:EB:E9:4A:87   |
+----------+---------------------+---------------------+---------------------+---------------------+
| 0x4      | B8:27:EB:1F:C3:23   | B8:27:EB:37:0F:06   | B8:27:EB:AF:1A:F3   | B8:27:EB:87:4D:83   |
+----------+---------------------+---------------------+---------------------+---------------------+
| 0x5      | B8:27:EB:7E:F5:D9   | B8:27:EB:38:DD:C7   | B8:27:EB:5B:8B:77   | B8:27:EB:08:2F:DE   |
+----------+---------------------+---------------------+---------------------+---------------------+
| 0x6      | B8:27:EB:73:CE:79   | B8:27:EB:F6:A8:5D   | B8:27:EB:78:7B:A3   | B8:27:EB:F6:50:B8   |
+----------+---------------------+---------------------+---------------------+---------------------+
| 0x7      | B8:27:EB:39:22:68   | B8:27:EB:8B:31:C7   | B8:27:EB:FC:01:AF   | B8:27:EB:E8:C2:6A   |
+----------+---------------------+---------------------+---------------------+---------------------+
| 0x8      | B8:27:EB:4E:CA:10   | B8:27:EB:FC:7E:24   | B8:27:EB:EF:D4:D5   | B8:27:EB:96:CB:E9   |
+----------+---------------------+---------------------+---------------------+---------------------+
| 0x9      | B8:27:EB:1E:E3:9F   | B8:27:EB:07:54:46   | B8:27:EB:D9:E1:52   | B8:27:EB:84:75:97   |
+----------+---------------------+---------------------+---------------------+---------------------+
| 0xA      | B8:27:EB:53:F2:86   | B8:27:EB:41:EE:0C   | B8:27:EB:DD:46:06   | B8:27:EB:E2:C3:6E   |
+----------+---------------------+---------------------+---------------------+---------------------+
| 0xB      | B8:27:EB:85:AD:ED   | B8:27:EB:45:BA:43   | B8:27:EB:32:AC:5D   | B8:27:EB:26:3C:3D   |
+----------+---------------------+---------------------+---------------------+---------------------+
| 0xC      | B8:27:EB:81:4C:93   | B8:27:EB:74:91:F0   | B8:27:EB:77:14:97   | B8:27:EB:4C:6F:A5   |
+----------+---------------------+---------------------+---------------------+---------------------+
| 0xD      | B8:27:EB:A2:47:0F   | B8:27:EB:DC:5E:F8   | B8:27:EB:C7:CE:08   | B8:27:EB:09:31:48   |
+----------+---------------------+---------------------+---------------------+---------------------+
| 0xE      | B8:27:EB:B7:DB:0F   | B8:27:EB:2E:33:17   | B8:27:EB:BD:D1:8F   | B8:27:EB:AA:89:FA   |
+----------+---------------------+---------------------+---------------------+---------------------+
| 0xF      | B8:27:EB:52:06:8E   | B8:27:EB:02:84:F0   | B8:27:EB:57:6E:2F   | B8:27:EB:D3:C9:CC   |
+----------+---------------------+---------------------+---------------------+---------------------+


Known Problems
-------------------------

`firmware issue <https://github.com/raspberrypi/firmware/issues/894>`_,
